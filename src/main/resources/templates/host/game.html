<!DOCTYPE html>
<html class="dark" lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>QuizMaster Live - Pregunta en Juego</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script th:src="@{/js/tailwind-config.js}"></script>
    <link rel="stylesheet" th:href="@{/css/estilos.css}">
    <!-- Refresco para ver estado -->
    <!-- Refresco eliminado para controlar flujo por JS -->
</head>
<body class="bg-background-light dark:bg-background-dark-alt text-white min-h-screen flex flex-col">
    <!-- Top Navigation Bar -->
    <header class="w-full border-b border-white/10 px-6 py-4 flex items-center justify-between bg-background-dark/50 backdrop-blur-md sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <div class="p-2 bg-primary rounded-lg flex items-center justify-center">
                <span class="material-symbols-outlined text-white">quiz</span>
            </div>
            <h2 class="text-xl font-bold tracking-tight hidden md:block">QuizLive Host <span class="text-xs bg-green-500 rounded px-1">v2.0</span></h2>
        </div>
        <div class="flex-1 max-w-2xl px-12">
            <div class="flex flex-col gap-2">
                <div class="flex justify-between text-xs font-semibold uppercase tracking-wider text-white/60">
                    <span>Pregunta <span th:text="${room.currentQuestionIndex + 1}">1</span></span>
                    <span>de <span th:text="${room.block.questions.size()}">10</span></span>
                </div>
                <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                    <div class="h-full bg-primary" th:style="'width: ' + (${(room.currentQuestionIndex + 1.0) / room.block.questions.size() * 100}) + '%;'"></div>
                </div>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <span class="text-sm font-bold text-white">PIN: <span th:text="${room.pin}"></span></span>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 container mx-auto px-6 py-8 flex flex-col items-center justify-center">
        <!-- Question & Timer Section -->
        <div class="w-full flex flex-col md:flex-row items-center gap-12 mb-12">
            <!-- Circular Timer -->
            <div class="relative flex-shrink-0">
                <div class="size-48 rounded-full border-8 border-white/5 flex items-center justify-center bg-[#302839]/40 backdrop-blur shadow-2xl">
                    <div class="flex flex-col items-center">
                        <span id="countdown" class="text-5xl font-bold text-white tabular-nums leading-none">--</span>
                        <span class="text-xs font-medium text-white/50 uppercase tracking-widest mt-1">Segundos</span>
                    </div>
                </div>
                <!-- SVG Timer Ring (Static Visual for now) -->
                <svg class="absolute inset-0 size-48 -rotate-90">
                    <circle cx="96" cy="96" fill="transparent" r="88" stroke="#7f0df2" stroke-dasharray="552.92" stroke-dashoffset="0" stroke-linecap="round" stroke-width="8"></circle>
                </svg>
            </div>
            
            <!-- Question Area -->
            <div class="flex-1 text-center md:text-left">
                <span class="inline-block px-3 py-1 bg-primary/20 text-primary-light text-sm font-bold rounded-lg mb-4 border border-primary/30 uppercase tracking-widest">Pregunta</span>
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold leading-tight text-white mb-4" th:text="${currentQuestion.statement}">
                    ¿Pregunta?
                </h1>
            </div>
        </div>

        <!-- Answer Grid -->
        <div class="w-full grid grid-cols-1 md:grid-cols-2 gap-4 max-w-6xl">
            <!-- Loop through options -->
            <div th:each="opt, stats : ${currentQuestion.options}" 
                 class="answer-card group relative flex items-center p-6 rounded-xl min-h-[140px] overflow-hidden"
                 th:classappend="${stats.index == 0 ? 'bg-quiz-red glow-red' : (stats.index == 1 ? 'bg-quiz-blue glow-blue' : (stats.index == 2 ? 'bg-quiz-yellow glow-yellow' : 'bg-quiz-green glow-green'))}">
                
                <div class="relative z-10 flex items-center gap-6 w-full">
                    <div class="size-16 bg-white/20 rounded-lg flex items-center justify-center backdrop-blur-sm group-hover:scale-110 transition-transform">
                        <!-- Iconos por índice -->
                        <span th:if="${stats.index == 0}" class="material-symbols-outlined text-4xl text-white font-bold filled-icon">change_history</span>
                        <span th:if="${stats.index == 1}" class="material-symbols-outlined text-4xl text-white font-bold filled-icon">pentagon</span>
                        <span th:if="${stats.index == 2}" class="material-symbols-outlined text-4xl text-white font-bold filled-icon">circle</span>
                        <span th:if="${stats.index == 3}" class="material-symbols-outlined text-4xl text-white font-bold filled-icon">square</span>
                    </div>
                    <span class="text-2xl md:text-3xl font-bold text-white text-left" th:text="${opt}">Opción</span>
                </div>
                <!-- Shine effect -->
                <div class="absolute top-0 left-0 w-full h-1/2 bg-gradient-to-b from-white/10 to-transparent"></div>
            </div>
        </div>
        
        <!-- Siguiente Button -->
        <div class="mt-8">
             <form th:action="@{/game/next}" method="post">
                <input type="hidden" name="pin" th:value="${room.pin}" />
            <button id="nextBtn" type="submit" class="opacity-30 pointer-events-none bg-white/10 hover:bg-white/20 px-8 py-4 rounded-xl text-lg font-bold transition-all border border-white/10 uppercase tracking-widest hover:scale-105">
                    Siguiente &rarr;
            </button>
            </form>
        </div>
    </main>

    <script th:inline="javascript">
        /*<![CDATA[*/
        var timeLimit = /*[[${room.timeLimit}]]*/ 20;
        var timeLeft = timeLimit; 
        var correctAnswerIndex = /*[[${currentQuestion.correctOptionIndex}]]*/ 0;
        var timerElement = document.getElementById("countdown");
        
        // Timer Logic
        var timerInterval = setInterval(function() {
             timeLeft -= 1;
             if(timeLeft >= 0) {
                 timerElement.innerText = timeLeft;
             }
             
             if(timeLeft <= 0) {
                clearInterval(timerInterval);
                timerElement.innerText = "0";
                revealAnswer();
             }
        }, 1000);
        
        function revealAnswer() {
             // 1. Play sound? (Optional)
             
             // 2. Dim all wrong answers
             var cards = document.querySelectorAll('.answer-card');
             cards.forEach((card, index) => {
                 if(index !== correctAnswerIndex) {
                     card.classList.add('opacity-30', 'blur-sm', 'grayscale');
                 } else {
                     card.classList.add('scale-110', 'z-20', 'shadow-[0_0_50px_rgba(255,255,255,0.5)]');
                     // Find the icon and animate it
                     var icon = card.querySelector('.material-symbols-outlined');
                     if(icon) icon.classList.add('animate-bounce');
                 }
             });
             
             // 3. Enable Next Button
             var btn = document.getElementById('nextBtn');
             if(btn) {
                 btn.classList.remove('opacity-30', 'pointer-events-none');
                 btn.classList.add('bg-primary', 'hover:bg-primary/90', 'shadow-lg', 'animate-pulse');
             }
        }
        /*]]>*/
    </script>
</body>
</html>
